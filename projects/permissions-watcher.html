<!DOCTYPE html>
<html lang="en">

<head>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-124183504-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-124183504-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Android application to help you to control the applications to which you grant permissions">
  <meta name="keywords" content="Android,Permissions,Firebase,Java,Realm,Lifecycle">
  <meta name="author" content="Noé Fernández">
  <meta name="robots" content="index,follow">

  <title>Project: Permissions Watcher</title>

  <!-- Bootstrap Core CSS -->
  <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Theme CSS -->
  <link href="../vendor/clean-blog/css/clean-blog.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link href="../css/style.css" rel="stylesheet">

  <!-- Custom Fonts -->
  <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Nunito:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <link rel="icon" type="image/x-icon" href="../img/favicon.ico" />
  <link rel="icon" type="image/png" href="../img/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="../img/favicon-16x16.png" sizes="16x16" />

</head>

<body>
  <button onclick="scrollToTop()" class="scrollTop-button" title="Go to top">Back to top</button>

  <!-- [_common] Navigation START -->
  <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
      <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header page-scroll">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                  <span class="sr-only">Toggle navigation</span>
                  <i class="fa fa-bars"></i>
              </button>
              <a class="navbar-brand" href="../index.html">Noé Fernández</a>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="navbar-collapse-1">
              <ul class="nav navbar-nav navbar-right">
                  <li>
                    <a href="../index.html">Home</a>
                  </li>
                  <li>
                    <a href="index.html"> > Projects < </a>
                  </li>
                  <li>
                    <a href="https://medium.com/@nfdz">Blog</a>
                  </li>
                  <li>
                    <a href="#" data-toggle="modal" data-target="#contact-modal">Contact</a>
                  </li>
              </ul>
          </div>
          <!-- /.navbar-collapse -->
      </div>
      <!-- /.container -->
  </nav>
  <!-- [_common] Navigation END -->

  <!-- [_common] Contact Modal START -->
  <div class="modal fade" id="contact-modal" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h3 class="modal-title text-center">Contact</h3>
        </div>
        <div class="modal-body text-center">
          <h4> Email </h4>
          <h3><a class="contact-email" href="mailto:noe.fernandez@protonmail.com?Subject=Hello" target="_top"> noe.fernandez@protonmail.com </a></h3>

          <br>
          <h4></span> Networks </h4>
          <!-- THIS CONTENT MUST BE THE SAME THAT FOOTER CONTENT -->
          <ul class="list-inline text-center">
              <li>
                  <a href="https://github.com/nfdz" target="_blank">
                      <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
              </li>
              <li>
                  <a href="https://www.linkedin.com/in/noe-fernandez/" target="_blank">
                      <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
              </li>
              <li>
                  <a href="https://twitter.com/nfdzls" target="_blank">
                      <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
              </li>
              <li>
                  <a href="https://medium.com/@nfdz" target="_blank">
                      <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-medium fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
              </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <!-- [_common] Contact Modal END -->

  <!-- Page Header -->
  <!-- Set your background image for this header on the line below. -->
  <header class="intro-header" style="background-image: url('img/permissions-watcher/project-bg.jpg')">
      <div class="container">
          <div class="row">
              <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                  <div class="post-heading">
                      <h1>Permissions Watcher</h1>
                      <h2 class="subheading">Take control of your permissions</h2>
                  </div>
              </div>
          </div>
      </div>
  </header>

  <!-- Post Content -->
  <article>
      <div class="container">
          <div class="row">
              <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                  <p>
                    The new Android permissions system is very powerful. Applications usually ask for permissions
                    in a context where they are justified. However, why do apps keep this acquired permission forever?
                  </p>
                  <p>
                    This question was the beginning of this pet project and summarize the concept very well. I have always
                    developed my pet project because I wanted to study or try something, try fresh features or just
                    I wanted to do it. The reason here is that I really miss this feature in android by default and
                    I was looking for any app that would do something like this and I wasn't able to find it. It is
                    strange because I know that this type of application won't make me rich (GPL heart), however I
                    feel that me and others would love have it.
                  </p>
                  <p>
                    I have use libraries and design patterns that I have already known in order to feel more
                    comfortable with them. As I was sure that this app was going to have an important number of
                    users I thought that was perfect to start using firebase analytics and crashlytics to study
                    how users uses my applications and fix important errors as soon as possible. I have used firebase
                    in my job but I have never use it in a pet project and I felt that this needs that.
                  </p>

                  <h2 class="section-heading">Concept</h2>

                  <p>
                    My idea was keep this application as simple as possible. I didn't want to implement a complex
                    app that only me could understand, so with few words, it shows the applications with permissions
                    changes (acquired) with a warning icon and alerts with a system notification as soon as possible
                    (<i>real time mode</i>) or once a day (<i>report mode</i>).
                  </p>

                  <p>
                    The application views and system notifications navigates to app settings to change permissions
                    quickly. It isn't possible to change the permissions inside the application without root
                    permissions and I didn’t want to develop a root-only app.
                  </p>

                  <h2 class="section-heading">Implementation</h2>

                  <p>
                    There are three activities (<i>MainActivityView</i>, <i>DetailsActivityView</i>, <i>SettingsActivity</i>)
                    and three services (<i>AnalysisJobIntentService</i>, <i>ReportJobService</i>, <i>RealTimeJobService</i>).
                  </p>

                  <p>
                    <i>MainActivityView</i> is the entry point of the application and shows all applications with permissions in a list view.
                  </p>

                  <center><img class="img-responsive" src="img/permissions-watcher/main-screenshot.png" alt=""></center>
                  <span class="caption text-muted">Main view</span>

                  <p>
                    <i>DetailsActivityView</i> shows more information about the permissions that uses and could use selected application.
                  </p>

                  <center><img class="img-responsive" src="img/permissions-watcher/details-screenshot.png" alt=""></center>
                  <span class="caption text-muted">Details view</span>

                  <p>
                    <i>SettingsActivity</i> has several configuration options to use the application as user needs.
                    I had to develop custom preference components for some configuration options. The implementation of the preference fragment
                    is from support library because it has compatibility with coordinator layout animations (it uses <i>RecyclerView</i> beneath).
                  </p>

                  <center><img class="img-responsive" src="img/permissions-watcher/settings-screenshot.png" alt=""></center>
                  <span class="caption text-muted">Settings view</span>

                  <p>
                    <i>AnalysisJobIntentService</i> handle the event of analyzing and reporting immediately using a system notification. This event is
                    triggered from a shortcut action.
                  </p>

                  <center><img class="img-responsive" src="img/permissions-watcher/shorcut-screenshot.png" alt=""></center>
                  <span class="caption text-muted">Shortcut action</span>

                  <p>
                    <i>ReportJobService</i> and <i>RealTimeJobService</i> perform an analysis and notify only if there are changes.
                    The only difference between them is the frequency of analysis. Both are implementations of <i>JobService</i> from the official framework.
                  </p>

                  <h3>MVP pattern</h3>

                  <p>
                    I have already used this pattern at other times. I think it is useful to keep the code organized in android.
                    It makes easy the maintenance and errors fixing. I have grouped the interfaces of the pattern into a parent interface called
                    'contract'. It shows a global and quick view of a feature. I recommend this approach for simple applications with not very complex views.
                    For example, the contract for the main view is as follows:
                  </p>

                  <pre><code>
public interface MainActivityContract {

    interface View {
        void bindViewToLiveData(LiveData<RealmResults<ApplicationInfo>> data);
        void navigateToAppDetails(ApplicationInfo app, ImageView appIcon);
        void filterContent(@Nullable String query);
    }

    interface Presenter {
        void initialize(Context context);
        void resume();
        void destroy();
        void onSyncSwipe();
        void onIgnoreAppClick(ApplicationInfo app);
        void onAppClick(ApplicationInfo app, ImageView appIcon);
        void onShowSystemAppsFlagChanged();
        void onSearchQueryChanged(@Nullable String query);
    }

    interface Model {
        void initialize(Context context);
        void destroy();
        void launchSynchronization();
        LiveData&ltRealmResults&ltApplicationInfo&gt&gt loadDataAsync();
        void toggleIgnoreFlag(ApplicationInfo app);
    }
}
                  </code></pre>

                  <h3>From Realm to LiveData</h3>

                  <p>
                   If you try the new android architecture components library, you won't want to go back to the past.
                   It makes android common things much easier since you forget about the management of the life cycle
                   of data objects or monitor updates. However, lots of main libraries don't work with this yet.
                   It is necessary to create a wrap for them. As you see below it is very simple:
                  </p>

                  <pre><code>
public static &ltT extends RealmObject&gt LiveData&ltT&gt asLiveData(T result) {
    return new RealmObjectLiveData&lt&gt(result);
}

public static class RealmObjectLiveData&ltT extends RealmObject&gt extends LiveData&ltT&gt {

    private T object;

    private final RealmChangeListener&ltT&gt listener =
            new RealmChangeListener&ltT&gt() {
                @Override
                public void onChange(@NonNull T result) {
                    setValue(result);
                }
            };

    public RealmObjectLiveData(T object) {
        this.object = object;
    }

    @Override
    protected void onActive() {
        object.addChangeListener(listener);
    }

    @Override
    protected void onInactive() {
        object.removeChangeListener(listener);
    }
}
                  </code></pre>
                  <h3>Libraries</h3>

                  <p>The 3rd party software that I have used for the application are:</p>

                  <ul>
                    <li>
                      <a href="http://jakewharton.github.io/butterknife/" target="_blank">Butter Knife</a>:
                      Bind Android views and callbacks to fields and methods.
                    </li>
                    <li>
                      <a href="https://github.com/JakeWharton/timber" target="_blank">Timber</a>:
                      A logger with a small, extensible API which provides utility on top of Android's normal Log class.
                    </li>
                    <li>
                      <a href="https://realm.io/" target="_blank">Realm</a>:
                      An open-source object database management system.
                    </li>
                    <li>
                      <a href="https://firebase.google.com/docs/analytics/" target="_blank">Firebase Analytics</a>:
                      It is a cost-free app measurement solution that provides insight into app usage and user engagement.
                      Activity analytics comes by default but you can log any analytics that you want.
                      For example, I log every time anyone use analyze shortcut action to know if users use this feature:
                      <pre><code>
firebaseAnalytics.logEvent(Analytics.Event.START_ANALYSIS, null);
                      </code></pre>
                    </li>
                    <li>
                      <a href="https://firebase.google.com/docs/crashlytics/" target="_blank">Firebase Crashlytics</a>:
                      It notifies detailed reports of the errors in the app. Runtime crash log comes by default but you can
                      log exceptions and errors you think that are interesting. For example, a click listener cannot retrieve
                      the object from the data list and I logs that error to know when this happens:
                      <pre><code>
FirebaseCrash.log("OnIgnoreClick app invalid position: position=" + position +
                  ", filteredData=" + (filteredData == null ? "null" : ""+filteredData.size()));
                      </code></pre>
                    </li>
                  </ul>

                  <h2 class="section-heading">Maintenance</h2>

                  <p>
                    The maintenance and improvement of the application has been very easy thanks to these tools.
                    Whenever there was a critical error that was reproduced several times in different users I received a notification
                    that alerted me immediately.
                  </p>

                  <p>
                    I don't have any trace of pending error to solve in the published version at the moment but I received several failures in the previous version.
                    In the panel there is the following:
                  </p>

                  <center><img class="img-responsive" src="img/permissions-watcher/firebase-crash.png" alt=""></center>
                  <span class="caption text-muted">Firebase crash</span>

                  <p>
                    There is a lot of extra information like android versions, architecture, brands. If they are common mistakes it gives you clues
                    and useful comments to solve them.
                  </p>

                  <h2 class="section-heading">Conclusion</h2>

                  <p>
                    Lots of users, and I, use this application daily basis to monitor the permissions we give to applications.
                    Only because of this, the development has been worth the time.
                  </p>

                  <p>
                    I have been able to improve my knowledge about the MVP pattern,
                    the Firebase libraries and the integration of Realm with the android architecture components.
                  </p>

                  <p>
                    I don't plan to add amazing features in the future, but feel free to contact me to suggest anything or report any bug.
                  </p>

                  <p>
                    The application is free software (GPLv3) and you can follow its development in
                    <a href="https://github.com/nfdz/PermissionsWatcher" target="_blank">github</a>.
                  </p>

                  <h3>Download</h3>
                  <ul>
                    <li><a href="https://play.google.com/store/apps/details?id=io.github.nfdz.permissionswatcher" target="_blank">Google Play</a></li>
                  </ul>

              </div>
          </div>
      </div>
  </article>

  <hr>

  <center><a href="index.html"><h3> ↩ More Projects </h3></a></center>

  <hr>

  <!-- [_common] Footer START -->
  <footer>
      <div class="container">
          <div class="row">
              <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                  <ul class="list-inline text-center">
                      <li>
                          <a href="https://github.com/nfdz" target="_blank">
                              <span class="fa-stack fa-lg">
                                  <i class="fa fa-circle fa-stack-2x"></i>
                                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                              </span>
                          </a>
                      </li>
                      <li>
                          <a href="https://www.linkedin.com/in/noe-fernandez/" target="_blank">
                              <span class="fa-stack fa-lg">
                                  <i class="fa fa-circle fa-stack-2x"></i>
                                  <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                              </span>
                          </a>
                      </li>
                      <li>
                          <a href="https://twitter.com/nfdzls" target="_blank">
                              <span class="fa-stack fa-lg">
                                  <i class="fa fa-circle fa-stack-2x"></i>
                                  <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                              </span>
                          </a>
                      </li>
                      <li>
                          <a href="https://medium.com/@nfdz" target="_blank">
                              <span class="fa-stack fa-lg">
                                  <i class="fa fa-circle fa-stack-2x"></i>
                                  <i class="fa fa-medium fa-stack-1x fa-inverse"></i>
                              </span>
                          </a>
                      </li>
                  </ul>
                  <p class="copyright text-muted">Copyright &copy; Noé Fernández 2018</p>
              </div>
          </div>
      </div>
  </footer>
  <!-- [_common] Footer END -->

  <!-- jQuery -->
  <script type="text/javascript" src="../vendor/jquery/jquery.min.js"></script>

  <!-- Bootstrap Core JavaScript -->
  <script type="text/javascript" src="../vendor/bootstrap/js/bootstrap.min.js"></script>

  <!-- Theme JavaScript -->
  <script type="text/javascript" src="../vendor/clean-blog/js/clean-blog.js"></script>

</body>

</html>
