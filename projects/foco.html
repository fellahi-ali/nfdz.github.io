<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="This project is about a minimalist text editor without distractions for Android. I have used the new Android Architecture Components to do it.">
  <meta name="keywords" content="Android,Java,Android Architecture Components,Room,ViewModel,LiveData,Minimalist text editor">
  <meta name="author" content="Noé Fernández">
  <meta name="robots" content="index,follow">

  <title>Project: foco</title>

  <!-- Bootstrap Core CSS -->
  <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Theme CSS -->
  <link href="../vendor/clean-blog/css/clean-blog.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link href="../css/style.css" rel="stylesheet">

  <!-- Custom Fonts -->
  <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Nunito:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <link rel="icon" type="image/x-icon" href="../img/favicon.ico" />
  <link rel="icon" type="image/png" href="../img/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="../img/favicon-16x16.png" sizes="16x16" />

  <!-- Google Analytics  -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-105568498-1', 'auto');
    ga('send', 'pageview');

  </script>
</head>

<body>
  <button onclick="scrollToTop()" class="scrollTop-button" title="Go to top">Back to top</button>

  <!-- [_common] Navigation START -->
  <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
      <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header page-scroll">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                  <span class="sr-only">Toggle navigation</span>
                  <i class="fa fa-bars"></i>
              </button>
              <a class="navbar-brand" href="../index.html">Noé Fernández</a>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="navbar-collapse-1">
              <ul class="nav navbar-nav navbar-right">
                  <li>
                    <a href="../index.html">Home</a>
                  </li>
                  <li>
                    <a href="index.html"> > Projects < </a>
                  </li>
                  <li>
                    <a href="https://medium.com/@nfdz">Blog</a>
                  </li>
                  <li>
                    <a href="#" data-toggle="modal" data-target="#contact-modal">Contact</a>
                  </li>
              </ul>
          </div>
          <!-- /.navbar-collapse -->
      </div>
      <!-- /.container -->
  </nav>
  <!-- [_common] Navigation END -->

  <!-- [_common] Contact Modal START -->
  <div class="modal fade" id="contact-modal" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h3 class="modal-title text-center">Contact</h3>
        </div>
        <div class="modal-body text-center">
          <h4> Email </h4>
          <h3><a class="contact-email" href="mailto:noe.fernandez@protonmail.com?Subject=Hello" target="_top"> noe.fernandez@protonmail.com </a></h3>

          <br>
          <h4></span> Networks </h4>
          <!-- THIS CONTENT MUST BE THE SAME THAT FOOTER CONTENT -->
          <ul class="list-inline text-center">
              <li>
                  <a href="https://github.com/nfdz" target="_blank">
                      <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
              </li>
              <li>
                  <a href="https://www.linkedin.com/in/noe-fernandez/" target="_blank">
                      <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
              </li>
              <li>
                  <a href="https://twitter.com/nfdzls" target="_blank">
                      <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
              </li>
              <li>
                  <a href="https://medium.com/@nfdz" target="_blank">
                      <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-medium fa-stack-1x fa-inverse"></i>
                      </span>
                  </a>
              </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <!-- [_common] Contact Modal END -->

  <!-- Page Header -->
  <!-- Set your background image for this header on the line below. -->
  <header class="intro-header" style="background-image: url('img/foco/project-bg.jpg')">
      <div class="container">
          <div class="row">
              <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                  <div class="post-heading">
                      <h1>foco</h1>
                      <h2 class="subheading">Minimalist text editor without distractions</h2>
                  </div>
              </div>
          </div>
      </div>
  </header>

  <!-- Post Content -->
  <article>
      <div class="container">
          <div class="row">
              <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                  <p>
                    This application can be considered a professional writing application without distractions and fuss since it has many useful features,
                    or also as a simple notes application because it is easy to use and tiny.
                  </p>

                  <p>
                    The features are as follows:
                  </p>

                  <ul>
                    <li>Markdown format (preview support)</li>
                    <li>Writing statistics (time, words count)</li>
                    <li>Ambient music</li>
                    <li>Right to left support</li>
                    <li>Import and Export</li>
                    <li>Starred files</li>
                    <li>Search</li>
                    <li>Tiny and battery friendly application</li>
                  </ul>

                  <p>
                    The application is compatible with 99% of Android devices. It does not send data to any server and it fully respects user privacy.
                  </p>

                  <h2 class="section-heading">Motivation</h2>

                  <p>
                    I wanted to continue developing applications from scratch on my own. I think it is the best way to settle knowledge and learn new ones.
                  </p>

                  <p>
                    In this case, on the one hand I wanted to use more the
                    <a href="https://developer.android.com/training/material/design-library.html" target="_blank">Android Design Support Library</a>.
                    I had used it before, but I wanted to continue testing it.
                  </p>

                  <p>
                    On the other hand, I wanted to try the new
                    <a href="https://developer.android.com/topic/libraries/architecture/index.html" target="_blank">Android Architecture Components</a> just released.
                    They are a new collection of libraries that help design robust, testable, and maintainable apps. It has several classes for managing
                    your UI component lifecycle and handling data persistence in a new way.
                  </p>

                  <p>
                    I am a person who likes to be updated and to know the latest news. When I saw the announcement of these components on
                    <a href="https://www.youtube.com/watch?v=FrteWKKVyzI" target="_blank">Google I/O 2017</a>
                    I was very sure that I was going to try as soon as I could in my next personal project.
                  </p>

                  <div class="video-responsive">
                    <iframe src="https://www.youtube.com/embed/vOJCrbr144o" frameborder="0" allowfullscreen></iframe>
                  </div>
                  <span class="caption text-muted">Android Architecture Components introduction</span>

                  <p>
                    Finally, I also wanted to develop an application that had a kind of embedded music player since I had never seriously developed anything like this.
                  </p>

                  <p>
                    The idea of this project had been around for a long time. There are not many minimal text editors in the store and most of them I do not like.
                    I wanted to develop my own editor following my point of view as a minimal text editor should be. It is a very attractive project since it does
                    not require a very high technical level and yet it is a very complete.
                  </p>

                  <h2 class="section-heading">Concept</h2>

                  <p>
                    My goal is to make it as simple and small as possible. This must integrate the features in an intuitive and transparent way.
                    In addition to the features listed above, it will have a markdown format helper with the following shortcuts:
                  </p>

                  <ul>
                    <li>H1, H2 and H3</li>
                    <li>Bold, italic and strikethrough</li>
                    <li>Quote</li>
                    <li>List (bulleted and numbered)</li>
                    <li>Link</li>
                    <li>Image and video (Youtube)</li>
                  </ul>

                  <p>
                    For the elaboration of the interface, I asked for help a graphic developer friend who gave me support in all aspects of the
                    interface (elements, fonts, colors, etc). The two together we elaborate a mockup to follow in its development.
                  </p>

                  <center><img class="img-responsive" src="img/foco/mockup.png" alt=""></center>
                  <span class="caption text-muted">Mockup</span>

                  <h2 class="section-heading">Implementation</h2>

                  <p>
                    There are only two activities (<i>MainActivity</i>, <i>EditDocActivity</i>) and one service (<i>MusicService</i>). However, I think it is important to
                    highlight some dialogues as they are very interesting (<i>EditDocCoverDialog</i> and <i>MusicDialog</i>).
                  </p>

                  <p>
                    <i>MainActivity</i> is the entry point to the application and shows all available documents in a grid. To do this, it uses a <i>RecyclerView</i>.
                    User can interact with documents in several ways (there is a bottom toolbar that appears when documents are selected). It is possible to
                    change the order and filter them.
                  </p>

                  <center><img class="img-responsive" src="img/foco/MainActivity-screenshots.png" alt=""></center>
                  <span class="caption text-muted">MainActivity screenshots</span>

                  <p>
                    <i>EditDocActivity</i> is the activity where user can edit a document and visualize its preview. On the one hand, <i>CustomEditText</i>
                    view has been used for editing. This class extends EditText and adds the functionality to add a listener to receive the
                    selection change events. It is thus possible to know when text is selected or deselected. This was necessary to be able
                    to offer a bottom toolbar with markdown format editing shortcuts.
                  </p>

                  <center><img class="img-responsive" src="img/foco/EditDocActivity-edit-screenshots.png" alt=""></center>
                  <span class="caption text-muted">EditDocActivity screenshots</span>

                  <p>
                    On the other hand, for the preview has been used MarkdownView that is a view defined in a third-party library with the same name.
                    It is very useful since it is easy to use and very powerful. It
                    <a href="https://github.com/tiagohm/MarkdownView#support" target="_blank">supports</a> several markdown formats and beautiful CSS themes.
                  </p>

                  <center><img class="img-responsive" src="img/foco/EditDocActivity-preview-screenshots.png" alt=""></center>
                  <span class="caption text-muted">Markdown preview screenshots</span>

                  <p>
                    <i>EditDocCoverDialog</i> has a lot of functionality. This extends <i>DialogFragment</i> in order to reuse it because according to the device
                    it could be a dialog or a fragment. The cover of a document can be a flat color or a custom image, so there are two tabs.
                    In the one tab, selected cover color is displayed and can be modified using <i>Material Color Picker Dialog</i>. In the other tab,
                    the selected cover image is displayed and can be modified using <i>File Picker Dialog</i>. It is careful with the images that the user
                    selects as they could be large and crash the application. To avoid this, it uses the options offered by the <i>Picasso</i> library
                    and the <i>Compressor</i> library to compress the image in case it is finally selected as the document cover.
                  </p>

                  <center><img class="img-responsive" src="img/foco/EditDocCoverDialog-screenshots.png" alt=""></center>
                  <span class="caption text-muted">EditDocCoverDialog screenshots</span>

                  <p>
                    <i>MusicDialog</i> also extends <i>DialogFragment</i>. It shows a simple interface to control the playback of ambient music.
                    To do this, it uses <i>RecyclerView</i> and several buttons. It connects to <i>MusicService</i> to retrieve playback information
                    and to perform actions. I think that this approach as dialog is the best one (instead of an activity) because ambient
                    music is an optional feature and the user will not use it for a long time.
                  </p>

                  <center><img class="img-responsive" src="img/foco/MusicDialog-screenshot.png" alt=""></center>
                  <span class="caption text-muted">MusicDialog screenshot</span>

                  <p>
                    <i>MusicService</i> is a bound service. This is responsible for managing the playback of ambient music. For this purpose, it uses a <i>MusicPlayer</i>.
                    The ambient music are tracks thought to play in loop stored in assets. It is possible to interact with this service through
                    defined intent actions or through its bind interface.
                  </p>

                  <p>
                    In order to not force to the user to open <i>MusicDialog</i> every time that wants to control the music, this service manages and controls a
                    notification while there is music playing. This notification has actions that use <i>PendingIntent</i> to control playback.
                  </p>

                  <center><img class="img-responsive" src="img/foco/MusicService-notification.png" alt=""></center>
                  <span class="caption text-muted">MusicService notification screenshot</span>

                  <h3>Android Architecture Components</h3>

                  <p>
                    For the persistence of data, the application makes use of
                    <a href="https://developer.android.com/topic/libraries/architecture/room.html" target="_blank">Room</a>.
                    Room provides an abstraction layer over SQLite to allow fluent database access while harnessing the full power of SQLite.
                    <i>Data Access Object</i> (DAO) interface called <i>DocumentDao</i> is defined. For example, it has this method to get a document:
                  </p>

                  <pre><code>
@Query("SELECT * FROM " + TABLE_NAME + " WHERE " + COLUMN_ID + " = :docId")
DocumentEntity getDocument(long docId);
                  </code></pre>

                  <p>
                    Entity class called <i>DocumentEntity</i> is defined. It implements <i>Document</i> interface and it has all attributes column names
                    defined as final static strings. There is a <i>DocumentMetadata</i> class that contains all attributes of <i>DocumentEntity</i> excepts
                    the text of the document. This is useful in order to retrieve a list of document avoiding store in memory each whole document.
                    Room deals with any class that it could match the column names with class attributes. For example, to get a document
                    metadata the DocumentDao method is:
                  </p>

                  <pre><code>
@Query("SELECT " + COLUMN_ID + ", " +COLUMN_NAME + ", " + COLUMN_WORKING_TIME +
       ", " + COLUMN_LAST_EDITION_TIME + ", " + COLUMN_WORDS + ", " + COLUMN_FAVORITE +
       ", " + COLUMN_COVER_COLOR +  ", " + COLUMN_COVER_IMAGE + " FROM " + TABLE_NAME +
       " WHERE " + COLUMN_ID + " = :docId")
DocumentMetadata getDocumentMetadata(long docId);
                  </code></pre>

                  <p>
                    The database that contains this DAO is defined in the <i>AppDatabase</i>. I use the singleton pattern to access and create the database.
                    It is only needed to do call a Room method to initialize the database and Room takes care of everything else by making use of its magic:
                  </p>

                  <pre><code>
sInstance = Room.databaseBuilder(context, AppDatabase.class, DATABASE_NAME).build();
                  </code></pre>

                  <p>
                    It is defined a
                    <a href="https://developer.android.com/topic/libraries/architecture/viewmodel.html" target="_blank">ViewModel</a> class
                    called <i>DocListViewModel</i> to manage the access of the data from the UI classes linked to the Android life cycle.
                    This extends <i>AndroidViewModel</i> class and provides access to a
                    <a href="https://developer.android.com/topic/libraries/architecture/livedata.html" target="_blank">LiveData</a> of a list of <i>DocumentMetadata</i>.
                    It uses <i>Transformations</i> class in its constructor to define this <i>LiveData</i> list when database is possibly not ready and needs
                    time to retrieve the data. <i>Transformations</i> will update this <i>LiveData</i> when database is ready and all documents are retrieved.
                    To use <i>DocListViewModel</i> it only has to do the following:
                  </p>

                  <pre><code>
DocListViewModel viewModel = ViewModelProviders.of(this).get(DocListViewModel.class);
viewModel.getDocumentsMetadata().observe(this, new Observer<List<DocumentMetadata>>() {
    @Override
    public void onChanged(@Nullable List<DocumentMetadata> docs) {
        // do something ...
    }
});
                  </code></pre>

                  <p>
                    As you can see it is no longer necessary to manage loaders or tasks to retrieve data asynchronously or maintain a cache with the
                    data to avoid retrieve data again with configuration changes. These new components do all this work for me in a transparent way.
                  </p>

                  <h3>Libraries</h3>

                  <p>The 3rd party software that I have used for the application are:</p>

                  <ul>
                    <li>
                      <a href="http://jakewharton.github.io/butterknife/" target="_blank">Butter Knife</a>:
                      Bind Android views and callbacks to fields and methods.
                    </li>
                    <li>
                      <a href="https://github.com/JakeWharton/timber" target="_blank">Timber</a>:
                      A logger with a small, extensible API which provides utility on top of Android's normal Log class.
                    </li>
                    <li>
                      <a href="http://square.github.io/picasso/" target="_blank">Picasso</a>:
                      A powerful image downloading and caching library for Android. For example,
                      I use it to load safely an image of unknown size that was selected by the user:
                      <pre><code>
Picasso.with(getActivity())
       .load(new File(mImagePath))
       .placeholder(R.drawable.image_placeholder)
       .memoryPolicy(MemoryPolicy.NO_CACHE)
       .resize(IMAGE_MAX_WIDTH_PX, IMAGE_MAX_HEIGHT_PX)
       .centerInside()
       .onlyScaleDown()
       .into(mImageView);
                      </code></pre>
                    </li>
                    <li>
                      <a href="https://github.com/Pes8/android-material-color-picker-dialog" target="_blank">Material Color Picker Dialog</a>:
                      A simple, minimalistic and beautiful dialog color picker. For example:
                      <pre><code>
final ColorPicker cp = new ColorPicker(getActivity(),
       Color.red(currentColor),
       Color.green(currentColor),
       Color.blue(currentColor));
cp.show();
cp.setCallback(new ColorPickerCallback() {
   @Override
   public void onColorChosen(@ColorInt int color) {
       // do something ...
   }
});
                      </code></pre>
                    </li>
                    <li>
                      <a href="https://github.com/Angads25/android-filepicker" target="_blank">FilePicker</a>:
                      A simple and minimalistic file picker dialog. For example:
                      <pre><code>
DialogProperties properties = new DialogProperties();
...
FilePickerDialog dialog = new FilePickerDialog(getActivity(), properties);
dialog.setDialogSelectionListener(new DialogSelectionListener() {
   @Override
   public void onSelectedFilePaths(String[] files) {
       // do something ...
   }
});
dialog.show();
                      </code></pre>
                    </li>
                    <li>
                      <a href="https://github.com/zetbaitsu/Compressor" target="_blank">Compressor</a>:
                      An Android image compression library. For example:
                      <pre><code>
File compressedImage = new Compressor(getActivity())
       .setMaxWidth(IMAGE_MAX_WIDTH_PX)
       .setMaxHeight(IMAGE_MAX_HEIGHT_PX)
       .setQuality(IMAGE_QUALITY)
       .setCompressFormat(Bitmap.CompressFormat.JPEG)
       .setDestinationDirectoryPath(directory.getAbsolutePath())
       .compressToFile(new File(image), name);
                      </code></pre>
                    </li>
                    <li>
                      <a href="https://github.com/tiagohm/MarkdownView" target="_blank">MarkdownView</a>:
                      An Android library to display markdown text in a beautiful way.
                    </li>
                  </ul>

                  <h2 class="section-heading">Conclusion</h2>

                  <p>
                    Thanks to this project I have been able to learn a lot of new knowledge. I liked working with the new Android Architecture Components
                    and in my opinion they have a great future ahead. However, I think for now I will continue using
                    <a href="https://realm.io/" target="_blank">Realm</a> in my projects for persistence as it is much more mature and I like more how it works.
                  </p>

                  <p>
                    The result is very close to the previous concept and most of the features are implemented. I think it does its purpose
                    perfectly and I hope it is useful to someone.
                  </p>

                  <p>
                    I do not plan to add amazing features in the future, but feel free to contact me to suggest anything or report any bug.
                  </p>

                  <p>
                    The application is free software (GPLv3) and you can check the whole project in
                    <a href="https://github.com/nfdz/foco" target="_blank">github</a>.
                  </p>

                  <h3>Download</h3>

                  <ul>
                    <li><a href="https://play.google.com/store/apps/details?id=io.github.nfdz.foco" target="_blank">Google Play</a></li>
                    <li><a href="https://github.com/nfdz/foco/releases" target="_blank">Github</a></li>
                  </ul>
              </div>
          </div>
      </div>
  </article>

  <hr>

  <center><a href="index.html"><h3> ↩ More Projects </h3></a></center>

  <hr>

  <!-- [_common] Footer START -->
  <footer>
      <div class="container">
          <div class="row">
              <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                  <ul class="list-inline text-center">
                      <li>
                          <a href="https://github.com/nfdz" target="_blank">
                              <span class="fa-stack fa-lg">
                                  <i class="fa fa-circle fa-stack-2x"></i>
                                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                              </span>
                          </a>
                      </li>
                      <li>
                          <a href="https://www.linkedin.com/in/noe-fernandez/" target="_blank">
                              <span class="fa-stack fa-lg">
                                  <i class="fa fa-circle fa-stack-2x"></i>
                                  <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                              </span>
                          </a>
                      </li>
                      <li>
                          <a href="https://twitter.com/nfdzls" target="_blank">
                              <span class="fa-stack fa-lg">
                                  <i class="fa fa-circle fa-stack-2x"></i>
                                  <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                              </span>
                          </a>
                      </li>
                      <li>
                          <a href="https://medium.com/@nfdz" target="_blank">
                              <span class="fa-stack fa-lg">
                                  <i class="fa fa-circle fa-stack-2x"></i>
                                  <i class="fa fa-medium fa-stack-1x fa-inverse"></i>
                              </span>
                          </a>
                      </li>
                  </ul>
                  <p class="copyright text-muted">Copyright &copy; Noé Fernández 2017</p>
              </div>
          </div>
      </div>
  </footer>
  <!-- [_common] Footer END -->

  <!-- jQuery -->
  <script type="text/javascript" src="../vendor/jquery/jquery.min.js"></script>

  <!-- Bootstrap Core JavaScript -->
  <script type="text/javascript" src="../vendor/bootstrap/js/bootstrap.min.js"></script>

  <!-- Theme JavaScript -->
  <script type="text/javascript" src="../vendor/clean-blog/js/clean-blog.js"></script>

</body>

</html>
